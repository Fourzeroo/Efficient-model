# –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ LLM-–ê–≥–µ–Ω—Ç–∞ –¥–ª—è Neural Architecture Search

## –û–±–∑–æ—Ä

–°–∏—Å—Ç–µ–º–∞ –ø—Ä–µ–¥—Å—Ç–∞–≤–ª—è–µ—Ç —Å–æ–±–æ–π LLM-–æ—Ä–∫–µ—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω–Ω—É—é –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—É –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–π –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏ –≥–∏–ø–µ—Ä–ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ –∏ –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã –º–æ–¥–µ–ª–∏ Informer –¥–ª—è –ø—Ä–æ–≥–Ω–æ–∑–∏—Ä–æ–≤–∞–Ω–∏—è –≤—Ä–µ–º–µ–Ω–Ω—ã—Ö —Ä—è–¥–æ–≤. –°–∏—Å—Ç–µ–º–∞ –ø–æ—Å—Ç—Ä–æ–µ–Ω–∞ –Ω–∞ –±–∞–∑–µ **LangGraph** –∏ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç LLM –¥–ª—è –ø—Ä–∏–Ω—è—Ç–∏—è —Ä–µ—à–µ–Ω–∏–π –æ–± –∏–∑–º–µ–Ω–µ–Ω–∏–∏ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ –º–æ–¥–µ–ª–∏.

## –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω—ã–π –ø–∞—Ç—Ç–µ—Ä–Ω

–°–∏—Å—Ç–µ–º–∞ —Ä–µ–∞–ª–∏–∑—É–µ—Ç –ø–∞—Ç—Ç–µ—Ä–Ω **State Machine** —Å —Ü–∏–∫–ª–∏—á–µ—Å–∫–∏–º –≥—Ä–∞—Ñ–æ–º –∏–∑ 4 –æ—Å–Ω–æ–≤–Ω—ã—Ö —É–∑–ª–æ–≤:

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ                    NAS LOOP                         ‚îÇ
‚îÇ                                                     ‚îÇ
‚îÇ  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê     ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê     ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê  ‚îÇ
‚îÇ  ‚îÇ Planner  ‚îÇ‚îÄ‚îÄ‚îÄ‚îÄ‚ñ∂‚îÇ Executor ‚îÇ‚îÄ‚îÄ‚îÄ‚îÄ‚ñ∂‚îÇ Evaluator ‚îÇ  ‚îÇ
‚îÇ  ‚îÇ  (LLM)   ‚îÇ     ‚îÇ (No LLM) ‚îÇ     ‚îÇ(Hybrid)   ‚îÇ  ‚îÇ
‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò     ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò     ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò  ‚îÇ
‚îÇ       ‚ñ≤                                    ‚îÇ        ‚îÇ
‚îÇ       ‚îÇ                                    ‚ñº        ‚îÇ
‚îÇ       ‚îÇ            ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê               ‚îÇ
‚îÇ       ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÇ Update State ‚îÇ               ‚îÇ
‚îÇ                    ‚îÇ   (No LLM)   ‚îÇ               ‚îÇ
‚îÇ                    ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò               ‚îÇ
‚îÇ                                                     ‚îÇ
‚îÇ  –£—Å–ª–æ–≤–∏–µ –≤—ã—Ö–æ–¥–∞: step_type="stop" –∏–ª–∏             ‚îÇ
‚îÇ  –¥–æ—Å—Ç–∏–∂–µ–Ω–∏–µ max_iterations                        ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

## –ö–æ–º–ø–æ–Ω–µ–Ω—Ç—ã —Å–∏—Å—Ç–µ–º—ã

### 1. Graph (`graph.py`)

**–†–æ–ª—å**: –û—Ä–∫–µ—Å—Ç—Ä–∞—Ü–∏—è –≤—Å–µ–≥–æ –ø—Ä–æ—Ü–µ—Å—Å–∞ NAS —á–µ—Ä–µ–∑ LangGraph

**–ò—Å–ø–æ–ª—å–∑—É–µ—Ç LLM**: –ù–µ—Ç (—Ç–æ–ª—å–∫–æ –∫–æ–æ—Ä–¥–∏–Ω–∞—Ü–∏—è)

**–û—Å–Ω–æ–≤–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏**:

- **`NASGraphState`** - —Ç–∏–ø–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ –≥—Ä–∞—Ñ–∞, —Å–æ–¥–µ—Ä–∂–∞—â–µ–µ:
  - Tracking: `iteration`, `max_iterations`
  - Planner outputs: `step_type`, `plan`, `reason`, `config_changes`
  - Executor outputs: `current_run_id`, `training_success`
  - Evaluator outputs: `accept_run`, `evaluation_reason`, `feedback`

- **`build_nas_graph()`** - —Å—Ç—Ä–æ–∏—Ç –≥—Ä–∞—Ñ —Å –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ—Å—Ç—å—é:
  ```
  Planner ‚Üí Executor ‚Üí Evaluator ‚Üí Update State ‚Üí (—É—Å–ª–æ–≤–Ω—ã–π –ø–µ—Ä–µ—Ö–æ–¥)
  ```

- **`should_continue()`** - —Ä–µ—à–∞–µ—Ç, –ø—Ä–æ–¥–æ–ª–∂–∞—Ç—å –ª–∏ —Ü–∏–∫–ª –∏–ª–∏ –æ—Å—Ç–∞–Ω–æ–≤–∏—Ç—å—Å—è:
  - –û—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç—Å—è –µ—Å–ª–∏ `step_type == "stop"`
  - –û—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç—Å—è –µ—Å–ª–∏ –¥–æ—Å—Ç–∏–≥–Ω—É—Ç–æ `max_iterations`
  - –ò–Ω–∞—á–µ –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç—Å—è –∫ Planner

**–£–∑–ª—ã –≥—Ä–∞—Ñ–∞**:

1. `planner_node` - –≤—ã–∑—ã–≤–∞–µ—Ç Planner agent
2. `executor_node` - –ø—Ä–∏–º–µ–Ω—è–µ—Ç –∏–∑–º–µ–Ω–µ–Ω–∏—è –∏ –∑–∞–ø—É—Å–∫–∞–µ—Ç –æ–±—É—á–µ–Ω–∏–µ
3. `evaluator_node` - –æ—Ü–µ–Ω–∏–≤–∞–µ—Ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã
4. `update_state_node` - –æ–±–Ω–æ–≤–ª—è–µ—Ç –≥–ª–æ–±–∞–ª—å–Ω–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ –∞–≥–µ–Ω—Ç–∞

---

### 2. Planner (`planner.py`)

**–†–æ–ª—å**: –ü—Ä–∏–Ω—è—Ç–∏–µ —Ä–µ—à–µ–Ω–∏–π –æ —Å–ª–µ–¥—É—é—â–∏—Ö –∏–∑–º–µ–Ω–µ–Ω–∏—è—Ö –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏

**–ò—Å–ø–æ–ª—å–∑—É–µ—Ç LLM**: ‚úÖ –î–∞ (–æ—Å–Ω–æ–≤–Ω–æ–π LLM-–∞–≥–µ–Ω—Ç —Å–∏—Å—Ç–µ–º—ã)

**–ú–æ–¥–µ–ª—å**: –ù–∞—Å—Ç—Ä–∞–∏–≤–∞–µ–º–∞—è —á–µ—Ä–µ–∑ `config.PLANNER_MODEL` (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é Claude 3.5 Sonnet)

**–¢–µ–º–ø–µ—Ä–∞—Ç—É—Ä–∞**: 0.7 (–¥–ª—è –∫—Ä–µ–∞—Ç–∏–≤–Ω–æ–≥–æ –ø–æ–∏—Å–∫–∞)

**Structured Output**: –ò—Å–ø–æ–ª—å–∑—É–µ—Ç Pydantic –º–æ–¥–µ–ª—å `PlannerDecision`:
```python
class PlannerDecision(BaseModel):
    step_type: str  # "small", "medium", "radical", "stop"
    plan: str       # –ß–µ–ª–æ–≤–µ–∫–æ-—á–∏—Ç–∞–µ–º—ã–π –ø–ª–∞–Ω
    reason: str     # –û–±–æ—Å–Ω–æ–≤–∞–Ω–∏–µ —Ä–µ—à–µ–Ω–∏—è
    config_changes: Dict[str, Any]  # –ö–æ–Ω–∫—Ä–µ—Ç–Ω—ã–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è
```

**–ö–æ–Ω—Ç–µ–∫—Å—Ç –¥–ª—è LLM**:
- –ò—Å—Ç–æ—Ä–∏—è –ø–æ—Å–ª–µ–¥–Ω–∏—Ö N –∑–∞–ø—É—Å–∫–æ–≤ (—É—Å–ø–µ—à–Ω—ã—Ö –∏ –Ω–µ—É–¥–∞—á–Ω—ã—Ö)
- –¢–µ–∫—É—â–∞—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –º–æ–¥–µ–ª–∏ (`config.py`)
- –ú–µ—Ç—Ä–∏–∫–∏ –ª—É—á—à–µ–≥–æ –∑–∞–ø—É—Å–∫–∞ (`best_run`)
- –ò–∑–º–µ–Ω–µ–Ω–∏—è, –∫–æ—Ç–æ—Ä—ã–µ –±—ã–ª–∏ –ø—Ä–∏–º–µ–Ω–µ–Ω—ã –≤ –ø—Ä–µ–¥—ã–¥—É—â–∏—Ö –∑–∞–ø—É—Å–∫–∞—Ö

**–¢–∏–ø—ã –∏–∑–º–µ–Ω–µ–Ω–∏–π**:
- **Small**: Fine-tuning –≥–∏–ø–µ—Ä–ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ (learning rate, batch size, dropout)
- **Medium**: –ò–∑–º–µ–Ω–µ–Ω–∏—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã (d_model, n_heads, e_layers, d_ff)
- **Radical**: –ö—Ä—É–ø–Ω—ã–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è (—Å–º–µ–Ω–∞ –æ–ø—Ç–∏–º–∏–∑–∞—Ç–æ—Ä–∞/scheduler, loss function)
- **Stop**: –û—Å—Ç–∞–Ω–æ–≤–∫–∞ –ø–æ–∏—Å–∫–∞

**–ú–µ—Ö–∞–Ω–∏–∑–º —Ä–∞–±–æ—Ç—ã**:
1. –ó–∞–≥—Ä—É–∂–∞–µ—Ç –∏—Å—Ç–æ—Ä–∏—é –∑–∞–ø—É—Å–∫–æ–≤ –∏–∑ `agent_state.json`
2. –§–æ—Ä–º–∞—Ç–∏—Ä—É–µ—Ç –∫–æ–Ω—Ç–µ–∫—Å—Ç —Å –º–µ—Ç—Ä–∏–∫–∞–º–∏ –∏ –∏–∑–º–µ–Ω–µ–Ω–∏—è–º–∏
3. –ó–∞–≥—Ä—É–∂–∞–µ—Ç —Ç–µ–∫—É—â—É—é –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é
4. –û—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –ø—Ä–æ–º–ø—Ç LLM —Å —Å—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–º –≤—ã—Ö–æ–¥–æ–º
5. –ü–æ–ª—É—á–∞–µ—Ç —Ä–µ—à–µ–Ω–∏–µ –∏ –æ–±–Ω–æ–≤–ª—è–µ—Ç —Å–æ—Å—Ç–æ—è–Ω–∏–µ –≥—Ä–∞—Ñ–∞

**–¢—Ä–µ–π—Å–∏–Ω–≥**: –õ–æ–≥–∏—Ä—É–µ—Ç –≤—Å–µ –æ–ø–µ—Ä–∞—Ü–∏–∏ —á–µ—Ä–µ–∑ Phoenix (–ø—Ä–æ–º–ø—Ç, —Ä–µ—à–µ–Ω–∏–µ, –∞—Ç—Ä–∏–±—É—Ç—ã)

---

### 3. Executor (`executor.py`)

**–†–æ–ª—å**: –ü—Ä–∏–º–µ–Ω–µ–Ω–∏–µ –∏–∑–º–µ–Ω–µ–Ω–∏–π –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ –∏ –∑–∞–ø—É—Å–∫ –æ–±—É—á–µ–Ω–∏—è

**–ò—Å–ø–æ–ª—å–∑—É–µ—Ç LLM**: ‚ùå –ù–µ—Ç (–¥–µ—Ç–µ—Ä–º–∏–Ω–∏—Å—Ç–∏—á–µ—Å–∫–∏–π)

**–û—Å–Ω–æ–≤–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏**:

#### `apply_config_changes(config_path, changes)`
–ú–æ–¥–∏—Ñ–∏—Ü–∏—Ä—É–µ—Ç Python-—Ñ–∞–π–ª –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ —á–µ—Ä–µ–∑ regex:
- –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç –≤–ª–æ–∂–µ–Ω–Ω—ã–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è —á–µ—Ä–µ–∑ dot-notation (`training.optimizer_params.lr`)
- –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –∏–∑–º–µ–Ω–µ–Ω–∏—è –∫–ª–∞—Å—Å–æ–≤ (optimizer, scheduler, loss function)
- –ò—Å–ø–æ–ª—å–∑—É–µ—Ç regex –¥–ª—è —Ç–æ—á–µ—á–Ω–æ–π –∑–∞–º–µ–Ω—ã –∑–Ω–∞—á–µ–Ω–∏–π

**–ü—Ä–∏–º–µ—Ä—ã –∏–∑–º–µ–Ω–µ–Ω–∏–π**:
```python
changes = {
    "training.optimizer_params.lr": 0.0001,      # Nested dict
    "model.d_model": 256,                         # Top-level dict
    "training.optimizer_class": "AdamW",          # Class reference
    "training.scheduler_class": "CosineAnnealingLR"
}
```

#### `run_training(config_path, tag)`
–ó–∞–ø—É—Å–∫–∞–µ—Ç –æ–±—É—á–µ–Ω–∏–µ —á–µ—Ä–µ–∑ subprocess:
- –ö–æ–º–∞–Ω–¥–∞: `python train.py --config config.py --tag run_XXXX`
- –í—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è –≤ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏ `nas_system/`
- –ó–∞—Ö–≤–∞—Ç—ã–≤–∞–µ—Ç stdout/stderr –¥–ª—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ –æ—à–∏–±–æ–∫

#### `load_run_results(run_id)`
–ó–∞–≥—Ä—É–∂–∞–µ—Ç –º–µ—Ç—Ä–∏–∫–∏ –∏ –∏—Å—Ç–æ—Ä–∏—é –∏–∑ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–Ω—ã—Ö —Ñ–∞–π–ª–æ–≤:
- `runs/run_XXXX/metrics.json`
- `runs/run_XXXX/history.json`

**–ú–µ—Ö–∞–Ω–∏–∑–º —Ä–∞–±–æ—Ç—ã**:
1. –ü—Ä–æ–≤–µ—Ä—è–µ—Ç, –Ω–µ —Ä–µ—à–∏–ª –ª–∏ Planner –æ—Å—Ç–∞–Ω–æ–≤–∏—Ç—å—Å—è
2. –ü—Ä–∏–º–µ–Ω—è–µ—Ç –∏–∑–º–µ–Ω–µ–Ω–∏—è –∫ `config.py`
3. –ó–∞–ø—É—Å–∫–∞–µ—Ç `train.py` —Å —É–Ω–∏–∫–∞–ª—å–Ω—ã–º —Ç–µ–≥–æ–º
4. –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç —É—Å–ø–µ—Ö/–æ—à–∏–±–∫—É –æ–±—É—á–µ–Ω–∏—è
5. –û–±–Ω–æ–≤–ª—è–µ—Ç —Å–æ—Å—Ç–æ—è–Ω–∏–µ —Å `training_success` —Ñ–ª–∞–≥–æ–º

**–¢—Ä–µ–π—Å–∏–Ω–≥**: –õ–æ–≥–∏—Ä—É–µ—Ç –ø—Ä–∏–º–µ–Ω–µ–Ω–∏–µ –∏–∑–º–µ–Ω–µ–Ω–∏–π –∏ —Å—Ç–∞—Ç—É—Å –æ–±—É—á–µ–Ω–∏—è

---

### 4. Evaluator (`evaluator.py`)

**–†–æ–ª—å**: –û—Ü–µ–Ω–∫–∞ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ –æ–±—É—á–µ–Ω–∏—è –∏ —Ä–µ—à–µ–Ω–∏–µ –æ –ø—Ä–∏–Ω—è—Ç–∏–∏/–æ—Ç–∫–ª–æ–Ω–µ–Ω–∏–∏

**–ò—Å–ø–æ–ª—å–∑—É–µ—Ç LLM**: ‚ö†Ô∏è –ì–∏–±—Ä–∏–¥–Ω—ã–π –ø–æ–¥—Ö–æ–¥ (–¥–µ—Ç–µ—Ä–º–∏–Ω–∏—Å—Ç–∏—á–µ—Å–∫–∏–µ –ø—Ä–∞–≤–∏–ª–∞ + LLM –¥–ª—è –ø–æ–≥—Ä–∞–Ω–∏—á–Ω—ã—Ö —Å–ª—É—á–∞–µ–≤)

**–ú–æ–¥–µ–ª—å**: –ù–∞—Å—Ç—Ä–∞–∏–≤–∞–µ–º–∞—è —á–µ—Ä–µ–∑ `config.EVALUATOR_MODEL` (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é Claude 3.5 Sonnet)

**–¢–µ–º–ø–µ—Ä–∞—Ç—É—Ä–∞**: 0.3 (–¥–ª—è –∫–æ–Ω—Å–∏—Å—Ç–µ–Ω—Ç–Ω–æ–π –æ—Ü–µ–Ω–∫–∏)

**Structured Output**: –ò—Å–ø–æ–ª—å–∑—É–µ—Ç Pydantic –º–æ–¥–µ–ª—å `EvaluatorDecision`:
```python
class EvaluatorDecision(BaseModel):
    accept: bool         # –ü—Ä–∏–Ω—è—Ç—å –∏–ª–∏ –æ—Ç–∫–ª–æ–Ω–∏—Ç—å
    reason: str          # –û–±–æ—Å–Ω–æ–≤–∞–Ω–∏–µ
    feedback: str        # –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –¥–ª—è —Å–ª–µ–¥—É—é—â–µ–π –∏—Ç–µ—Ä–∞—Ü–∏–∏
```

#### –î–≤—É—Ö—É—Ä–æ–≤–Ω–µ–≤–∞—è —Å–∏—Å—Ç–µ–º–∞ –æ—Ü–µ–Ω–∫–∏:

**–£—Ä–æ–≤–µ–Ω—å 1: –î–µ—Ç–µ—Ä–º–∏–Ω–∏—Å—Ç–∏—á–µ—Å–∫–∏–µ –ø—Ä–∞–≤–∏–ª–∞** (`evaluate_run_deterministic`)

–ü—Ä–∞–≤–∏–ª–∞ –±—ã—Å—Ç—Ä–æ–π –æ—Ü–µ–Ω–∫–∏:
- ‚úÖ **Accept** –µ—Å–ª–∏ —É–ª—É—á—à–µ–Ω–∏–µ > 2%
- ‚ùå **Reject** –µ—Å–ª–∏ —É—Ö—É–¥—à–µ–Ω–∏–µ > 0.5%
- ‚ùå **Reject** –µ—Å–ª–∏ —Å–∏–ª—å–Ω–æ–µ –ø–µ—Ä–µ–æ–±—É—á–µ–Ω–∏–µ (train/val gap > 50%)
- ‚ùå **Reject** –µ—Å–ª–∏ —Ä–∞–Ω–Ω—è—è –æ—Å—Ç–∞–Ω–æ–≤–∫–∞ –Ω–∞ —ç–ø–æ—Ö–µ < 3
- ü§î **Borderline** –µ—Å–ª–∏ —É–ª—É—á—à–µ–Ω–∏–µ 0-2% –∏–ª–∏ —É—Ö—É–¥—à–µ–Ω–∏–µ 0-0.5%

**–£—Ä–æ–≤–µ–Ω—å 2: LLM Evaluator** (`evaluate_with_llm`)

–í—ã–∑—ã–≤–∞–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ –¥–ª—è –ø–æ–≥—Ä–∞–Ω–∏—á–Ω—ã—Ö —Å–ª—É—á–∞–µ–≤:
- –ê–Ω–∞–ª–∏–∑–∏—Ä—É–µ—Ç –¥–∏–Ω–∞–º–∏–∫—É –æ–±—É—á–µ–Ω–∏—è
- –°—Ä–∞–≤–Ω–∏–≤–∞–µ—Ç —Å –ª—É—á—à–∏–º –∑–∞–ø—É—Å–∫–æ–º
- –£—á–∏—Ç—ã–≤–∞–µ—Ç –ø—Ä–∏–º–µ–Ω–µ–Ω–Ω—ã–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è
- –î–∞–µ—Ç –æ–±–æ—Å–Ω–æ–≤–∞–Ω–Ω—É—é —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—é

**–ö–æ–Ω—Ç–µ–∫—Å—Ç –¥–ª—è LLM**:
- –ú–µ—Ç—Ä–∏–∫–∏ –Ω–æ–≤–æ–≥–æ –∑–∞–ø—É—Å–∫–∞ (val_mse, test_mse, train_mse, best_epoch)
- –ú–µ—Ç—Ä–∏–∫–∏ –ª—É—á—à–µ–≥–æ –∑–∞–ø—É—Å–∫–∞
- –ü—Ä–∏–º–µ–Ω–µ–Ω–Ω—ã–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏
- –°–≤–æ–¥–∫–∞ –∏—Å—Ç–æ—Ä–∏–∏ –æ–±—É—á–µ–Ω–∏—è (–¥–∏–Ω–∞–º–∏–∫–∞ loss, —Å–∏–≥–Ω–∞–ª—ã –ø–µ—Ä–µ–æ–±—É—á–µ–Ω–∏—è)

**–ú–µ—Ö–∞–Ω–∏–∑–º —Ä–∞–±–æ—Ç—ã**:
1. –ü—Ä–æ–≤–µ—Ä—è–µ—Ç —É—Å–ø–µ—à–Ω–æ—Å—Ç—å –æ–±—É—á–µ–Ω–∏—è
2. –ó–∞–≥—Ä—É–∂–∞–µ—Ç –º–µ—Ç—Ä–∏–∫–∏ –∏ –∏—Å—Ç–æ—Ä–∏—é –∑–∞–ø—É—Å–∫–∞
3. –ü—Ä–∏–º–µ–Ω—è–µ—Ç –¥–µ—Ç–µ—Ä–º–∏–Ω–∏—Å—Ç–∏—á–µ—Å–∫–∏–µ –ø—Ä–∞–≤–∏–ª–∞
4. –ï—Å–ª–∏ —Ä–µ–∑—É–ª—å—Ç–∞—Ç –ø–æ–≥—Ä–∞–Ω–∏—á–Ω—ã–π ‚Üí –≤—ã–∑—ã–≤–∞–µ—Ç LLM
5. –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç —Ä–µ—à–µ–Ω–∏–µ –∏ feedback

**–¢—Ä–µ–π—Å–∏–Ω–≥**: –õ–æ–≥–∏—Ä—É–µ—Ç –º–µ—Ç–æ–¥ –æ—Ü–µ–Ω–∫–∏ (deterministic/llm) –∏ —Ä–µ—à–µ–Ω–∏–µ

---

### 5. Update State Node

**–†–æ–ª—å**: –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ –∑–∞–ø—É—Å–∫–∞ –≤ –≥–ª–æ–±–∞–ª—å–Ω–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ

**–ò—Å–ø–æ–ª—å–∑—É–µ—Ç LLM**: ‚ùå –ù–µ—Ç (–¥–µ—Ç–µ—Ä–º–∏–Ω–∏—Å—Ç–∏—á–µ—Å–∫–∏–π)

**–û—Å–Ω–æ–≤–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏**:
- –ó–∞–≥—Ä—É–∂–∞–µ—Ç `agent_state.json`
- –°–æ–∑–¥–∞–µ—Ç `RunInfo` –æ–±—ä–µ–∫—Ç —Å —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞–º–∏
- –î–æ–±–∞–≤–ª—è–µ—Ç –∑–∞–ø—É—Å–∫ –≤ –∏—Å—Ç–æ—Ä–∏—é
- –°–æ—Ö—Ä–∞–Ω—è–µ—Ç –æ–±–Ω–æ–≤–ª–µ–Ω–Ω–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ
- –ò–Ω–∫—Ä–µ–º–µ–Ω—Ç–∏—Ä—É–µ—Ç —Å—á–µ—Ç—á–∏–∫ –∏—Ç–µ—Ä–∞—Ü–∏–π

**–°–æ—Ö—Ä–∞–Ω—è–µ–º—ã–µ –¥–∞–Ω–Ω—ã–µ**:
```python
RunInfo:
    run_id: str              # "run_0001"
    val_mse: float           # Validation MSE
    test_mse: float          # Test MSE
    history_summary: str     # –ö—Ä–∞—Ç–∫–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ –¥–∏–Ω–∞–º–∏–∫–∏
    accepted: bool           # –ü—Ä–∏–Ω—è—Ç –∏–ª–∏ –æ—Ç–∫–ª–æ–Ω–µ–Ω
    config_changes: Dict     # –ü—Ä–∏–º–µ–Ω–µ–Ω–Ω—ã–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è
```

---

### 6. Configuration (`config.py`)

**–†–æ–ª—å**: –¶–µ–Ω—Ç—Ä–∞–ª–∏–∑–æ–≤–∞–Ω–Ω–∞—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è —Å–∏—Å—Ç–µ–º—ã

**–û—Å–Ω–æ–≤–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã**:

**API –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è**:
- `OPENROUTER_API_KEY` - –∫–ª—é—á –¥–ª—è OpenRouter
- `OPENROUTER_BASE_URL` - —ç–Ω–¥–ø–æ–∏–Ω—Ç API
- `PLANNER_MODEL` - –º–æ–¥–µ–ª—å –¥–ª—è Planner (Claude 3.5 Sonnet)
- `EVALUATOR_MODEL` - –º–æ–¥–µ–ª—å –¥–ª—è Evaluator
- `PLANNER_TEMPERATURE` - 0.7 (–∫—Ä–µ–∞—Ç–∏–≤–Ω–æ—Å—Ç—å)
- `EVALUATOR_TEMPERATURE` - 0.3 (–∫–æ–Ω—Å–∏—Å—Ç–µ–Ω—Ç–Ω–æ—Å—Ç—å)

**–ü—É—Ç–∏**:
- `NAS_SYSTEM_ROOT` - –∫–æ—Ä–Ω–µ–≤–∞—è –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—è —Å–∏—Å—Ç–µ–º—ã –æ–±—É—á–µ–Ω–∏—è
- `CONFIG_PATH` - –ø—É—Ç—å –∫ `config.py` –º–æ–¥–µ–ª–∏
- `RUNS_ROOT` - –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—è —Å —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞–º–∏ –∑–∞–ø—É—Å–∫–æ–≤
- `AGENT_STATE_PATH` - –ø—É—Ç—å –∫ `agent_state.json`

**NAS –ø–∞—Ä–∞–º–µ—Ç—Ä—ã**:
- `DEFAULT_MAX_ITERATIONS` - 20 –∏—Ç–µ—Ä–∞—Ü–∏–π –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é
- `RECENT_RUNS_WINDOW` - 5 –ø–æ—Å–ª–µ–¥–Ω–∏—Ö –∑–∞–ø—É—Å–∫–æ–≤ –≤ –∫–æ–Ω—Ç–µ–∫—Å—Ç–µ

**Observability (Phoenix)**:
- `PHOENIX_ENABLED` - –≤–∫–ª—é—á–∏—Ç—å —Ç—Ä–µ–π—Å–∏–Ω–≥
- `PHOENIX_HOST` / `PHOENIX_PORT` - –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã Phoenix —Å–µ—Ä–≤–µ—Ä–∞
- `PHOENIX_COLLECTOR_ENDPOINT` - —ç–Ω–¥–ø–æ–∏–Ω—Ç –¥–ª—è OTEL traces

**Debug**:
- `VERBOSE` - –ø–æ–¥—Ä–æ–±–Ω—ã–π –≤—ã–≤–æ–¥
- `DEBUG` - –æ—Ç–ª–∞–¥–æ—á–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è

---

### 7. Prompts (`prompts.py`)

**–†–æ–ª—å**: –ü—Ä–æ–º–ø—Ç-–∏–Ω–∂–∏–Ω–∏—Ä–∏–Ω–≥ –¥–ª—è LLM –∞–≥–µ–Ω—Ç–æ–≤

**–ü—Ä–æ–º–ø—Ç—ã**:

#### `PLANNER_PROMPT`
- –î–ª–∏–Ω–Ω—ã–π –∫–æ–Ω—Ç–µ–∫—Å—Ç–Ω—ã–π –ø—Ä–æ–º–ø—Ç —Å:
  - –¢–µ–∫—É—â–∏–º —Å–æ—Å—Ç–æ—è–Ω–∏–µ–º (iteration, best_mse)
  - –ò—Å—Ç–æ—Ä–∏–µ–π –∑–∞–ø—É—Å–∫–æ–≤ —Å –º–µ—Ç—Ä–∏–∫–∞–º–∏ –∏ –∏–∑–º–µ–Ω–µ–Ω–∏—è–º–∏
  - –¢–µ–∫—É—â–µ–π –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–µ–π
  - –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏—è–º–∏ –ø–æ –≤—ã–±–æ—Ä—É step_type
  - –ü—Ä–∏–º–µ—Ä–∞–º–∏ config_changes

#### `EVALUATOR_PROMPT`
- –ü—Ä–æ–º–ø—Ç –¥–ª—è –ø–æ–≥—Ä–∞–Ω–∏—á–Ω—ã—Ö —Å–ª—É—á–∞–µ–≤:
  - –°—Ä–∞–≤–Ω–µ–Ω–∏–µ –º–µ—Ç—Ä–∏–∫ –Ω–æ–≤–æ–≥–æ –∏ –ª—É—á—à–µ–≥–æ –∑–∞–ø—É—Å–∫–∞
  - –ü—Ä–∏–º–µ–Ω–µ–Ω–Ω—ã–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è
  - –ò—Å—Ç–æ—Ä–∏—è –æ–±—É—á–µ–Ω–∏—è
  - –ö—Ä–∏—Ç–µ—Ä–∏–∏ –ø—Ä–∏–Ω—è—Ç–∏—è/–æ—Ç–∫–ª–æ–Ω–µ–Ω–∏—è

**–£—Ç–∏–ª–∏—Ç—ã —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏—è**:
- `format_recent_runs()` - —Ñ–æ—Ä–º–∞—Ç–∏—Ä—É–µ—Ç –∏—Å—Ç–æ—Ä–∏—é –¥–ª—è –ø—Ä–æ–º–ø—Ç–∞
- `format_config_section()` - —Ñ–æ—Ä–º–∞—Ç–∏—Ä—É–µ—Ç –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é –≤ —á–∏—Ç–∞–µ–º—ã–π –≤–∏–¥

---

### 8. Phoenix Tracing (`phoenix_tracing.py`)

**–†–æ–ª—å**: Observability –∏ —Ç—Ä–µ–π—Å–∏–Ω–≥ —á–µ—Ä–µ–∑ Arize Phoenix

**–ò—Å–ø–æ–ª—å–∑—É–µ—Ç LLM**: ‚ùå –ù–µ—Ç (–∏–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä–∞)

**–û—Å–Ω–æ–≤–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏**:

#### `setup_phoenix_tracing()`
–ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ—Ç —Ç—Ä–µ–π—Å–∏–Ω–≥:
- –†–µ–≥–∏—Å—Ç—Ä–∏—Ä—É–µ—Ç OTEL tracer provider
- –ò–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–∏—Ä—É–µ—Ç LangChain
- –ò–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–∏—Ä—É–µ—Ç OpenAI (–¥–ª—è –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è –ø—Ä–æ–º–ø—Ç–æ–≤/–æ—Ç–≤–µ—Ç–æ–≤)

#### `trace_operation(name, attributes)`
Context manager –¥–ª—è —Ç—Ä–µ–π—Å–∏–Ω–≥–∞ –∫–∞—Å—Ç–æ–º–Ω—ã—Ö –æ–ø–µ—Ä–∞—Ü–∏–π:
```python
with trace_operation("planner_agent", {"iteration": 5}):
    plan_next_iteration(state)
```

#### –£—Ç–∏–ª–∏—Ç—ã:
- `add_span_attribute(key, value)` - –¥–æ–±–∞–≤–ª—è–µ—Ç –∞—Ç—Ä–∏–±—É—Ç –∫ —Ç–µ–∫—É—â–µ–º—É span
- `add_span_event(name, attributes)` - –¥–æ–±–∞–≤–ª—è–µ—Ç —Å–æ–±—ã—Ç–∏–µ
- `is_phoenix_enabled()` - –ø—Ä–æ–≤–µ—Ä—è–µ—Ç —Å—Ç–∞—Ç—É—Å —Ç—Ä–µ–π—Å–∏–Ω–≥–∞

**–õ–æ–≥–∏—Ä—É–µ–º—ã–µ –¥–∞–Ω–Ω—ã–µ**:
- –í—Å–µ LLM –≤—ã–∑–æ–≤—ã (–ø—Ä–æ–º–ø—Ç—ã, –æ—Ç–≤–µ—Ç—ã, —Ç–æ–∫–µ–Ω—ã)
- –û–ø–µ—Ä–∞—Ü–∏–∏ —É–∑–ª–æ–≤ –≥—Ä–∞—Ñ–∞
- –†–µ—à–µ–Ω–∏—è –∏ –º–µ—Ç—Ä–∏–∫–∏
- –û—à–∏–±–∫–∏ –∏ –∏—Å–∫–ª—é—á–µ–Ω–∏—è

**UI**: –î–æ—Å—Ç—É–ø–µ–Ω –ø–æ `http://localhost:6006` (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é)

---

### 9. Main (`main.py`)

**–†–æ–ª—å**: –¢–æ—á–∫–∞ –≤—Ö–æ–¥–∞ –∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∂–∏–∑–Ω–µ–Ω–Ω—ã–º —Ü–∏–∫–ª–æ–º

**–ò—Å–ø–æ–ª—å–∑—É–µ—Ç LLM**: ‚ùå –ù–µ—Ç (–æ—Ä–∫–µ—Å—Ç—Ä–∞—Ü–∏—è)

**–û—Å–Ω–æ–≤–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è**: `run_nas_optimization(max_iterations)`

**–†–∞–±–æ—á–∏–π –ø—Ä–æ—Ü–µ—Å—Å**:
1. –ó–∞–≥—Ä—É–∂–∞–µ—Ç —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ –∏–∑ `agent_state.json`
2. –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ—Ç Phoenix —Ç—Ä–µ–π—Å–∏–Ω–≥
3. –°—Ç—Ä–æ–∏—Ç LangGraph —á–µ—Ä–µ–∑ `build_nas_graph()`
4. –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ—Ç –Ω–∞—á–∞–ª—å–Ω–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ
5. –ó–∞–ø—É—Å–∫–∞–µ—Ç –≥—Ä–∞—Ñ —á–µ—Ä–µ–∑ `graph.invoke()`
6. –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –∑–∞–≤–µ—Ä—à–µ–Ω–∏–µ/–ø—Ä–µ—Ä—ã–≤–∞–Ω–∏–µ
7. –í—ã–≤–æ–¥–∏—Ç —Ñ–∏–Ω–∞–ª—å–Ω—É—é —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É

**CLI –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å**:
```bash
python -m nas_agent_graph.main --max-iterations 20 --verbose --debug
```

---

## –ü–æ—Ç–æ–∫ –¥–∞–Ω–Ω—ã—Ö

### –û–¥–Ω–∞ –∏—Ç–µ—Ä–∞—Ü–∏—è NAS:

```
1. PLANNER NODE
   ‚îú‚îÄ –ó–∞–≥—Ä—É–∂–∞–µ—Ç agent_state.json
   ‚îú‚îÄ –ü–æ–ª—É—á–∞–µ—Ç best_run –∏ recent_runs
   ‚îú‚îÄ –ó–∞–≥—Ä—É–∂–∞–µ—Ç —Ç–µ–∫—É—â–∏–π config.py
   ‚îú‚îÄ –§–æ—Ä–º–∞—Ç–∏—Ä—É–µ—Ç –ø—Ä–æ–º–ø—Ç —Å –∫–æ–Ω—Ç–µ–∫—Å—Ç–æ–º
   ‚îú‚îÄ LLM ‚Üí PlannerDecision
   ‚îî‚îÄ –û–±–Ω–æ–≤–ª—è–µ—Ç state: {step_type, plan, reason, config_changes}

2. EXECUTOR NODE
   ‚îú‚îÄ –ü—Ä–æ–≤–µ—Ä—è–µ—Ç step_type != "stop"
   ‚îú‚îÄ –ü—Ä–∏–º–µ–Ω—è–µ—Ç config_changes –∫ config.py (regex)
   ‚îú‚îÄ –ó–∞–ø—É—Å–∫–∞–µ—Ç: python train.py --tag run_XXXX
   ‚îú‚îÄ –ñ–¥–µ—Ç –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è –æ–±—É—á–µ–Ω–∏—è
   ‚îî‚îÄ –û–±–Ω–æ–≤–ª—è–µ—Ç state: {current_run_id, training_success}

3. EVALUATOR NODE
   ‚îú‚îÄ –ü—Ä–æ–≤–µ—Ä—è–µ—Ç training_success
   ‚îú‚îÄ –ó–∞–≥—Ä—É–∂–∞–µ—Ç metrics.json –∏ history.json
   ‚îú‚îÄ –ü—Ä–∏–º–µ–Ω—è–µ—Ç –¥–µ—Ç–µ—Ä–º–∏–Ω–∏—Å—Ç–∏—á–µ—Å–∫–∏–µ –ø—Ä–∞–≤–∏–ª–∞
   ‚îú‚îÄ –ï—Å–ª–∏ borderline ‚Üí LLM ‚Üí EvaluatorDecision
   ‚îî‚îÄ –û–±–Ω–æ–≤–ª—è–µ—Ç state: {accept_run, evaluation_reason, feedback}

4. UPDATE STATE NODE
   ‚îú‚îÄ –°–æ–∑–¥–∞–µ—Ç RunInfo –æ–±—ä–µ–∫—Ç
   ‚îú‚îÄ –î–æ–±–∞–≤–ª—è–µ—Ç –≤ agent_state.runs[]
   ‚îú‚îÄ –°–æ—Ö—Ä–∞–Ω—è–µ—Ç agent_state.json
   ‚îú‚îÄ –ò–Ω–∫—Ä–µ–º–µ–Ω—Ç–∏—Ä—É–µ—Ç state.iteration
   ‚îî‚îÄ –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç –æ–±–Ω–æ–≤–ª–µ–Ω–Ω–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ

5. CONDITIONAL EDGE
   ‚îú‚îÄ –ü—Ä–æ–≤–µ—Ä—è–µ—Ç: step_type == "stop"?
   ‚îú‚îÄ –ü—Ä–æ–≤–µ—Ä—è–µ—Ç: iteration >= max_iterations?
   ‚îî‚îÄ ‚Üí "continue" (–∫ Planner) –∏–ª–∏ "stop" (END)
```

---

## –í–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏–µ —Å –≤–Ω–µ—à–Ω–∏–º–∏ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞–º–∏

### –° —Å–∏—Å—Ç–µ–º–æ–π –æ–±—É—á–µ–Ω–∏—è (`nas_system/`):

**–ò—Å–ø–æ–ª—å–∑—É–µ–º—ã–µ –º–æ–¥—É–ª–∏**:
- `nas_system.nas_agent`:
  - `load_agent_state()` / `save_agent_state()`
  - `get_best_run()` / `get_recent_runs()`
  - `add_run()`
  - `build_history_summary()`
  - –¢–∏–ø—ã: `AgentState`, `RunInfo`

**–ò—Å–ø–æ–ª—å–∑—É–µ–º—ã–µ —Ñ–∞–π–ª—ã**:
- `config.py` - –º–æ–¥–∏—Ñ–∏—Ü–∏—Ä—É–µ—Ç—Å—è Executor
- `train.py` - –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è —á–µ—Ä–µ–∑ subprocess
- `agent_state.json` - –≥–ª–æ–±–∞–ª—å–Ω–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ
- `runs/run_XXXX/` - —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã –∫–∞–∂–¥–æ–≥–æ –∑–∞–ø—É—Å–∫–∞

### –° LLM API (—á–µ—Ä–µ–∑ OpenRouter):

**–ú–æ–¥–µ–ª–∏**:
- Planner: `anthropic/claude-3.5-sonnet` (configurable)
- Evaluator: `anthropic/claude-3.5-sonnet` (configurable)

**–ë–∏–±–ª–∏–æ—Ç–µ–∫–∞**: LangChain (`langchain_openai.ChatOpenAI`)

**Structured Output**: —á–µ—Ä–µ–∑ Pydantic models –∏ `.with_structured_output()`

### –° Phoenix (Observability):

**–ò–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–∞—Ü–∏—è**:
- `openinference.instrumentation.langchain.LangChainInstrumentor`
- `openinference.instrumentation.openai.OpenAIInstrumentor`

**OTEL traces** –æ—Ç–ø—Ä–∞–≤–ª—è—é—Ç—Å—è –Ω–∞ `http://localhost:6006/v1/traces`

---

## –ö–ª—é—á–µ–≤—ã–µ —Ä–µ—à–µ–Ω–∏—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã

### 1. LangGraph –≤–º–µ—Å—Ç–æ –ø—Ä–æ—Å—Ç–æ–≥–æ —Ü–∏–∫–ª–∞
‚úÖ **–ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞**:
- –Ø–≤–Ω–∞—è –º–∞—à–∏–Ω–∞ —Å–æ—Å—Ç–æ—è–Ω–∏–π
- –í—Å—Ç—Ä–æ–µ–Ω–Ω–∞—è –ø–æ–¥–¥–µ—Ä–∂–∫–∞ —Ç—Ä–µ–π—Å–∏–Ω–≥–∞
- –£–¥–æ–±–Ω–∞—è –≤–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—è –ø–æ—Ç–æ–∫–∞
- –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è/–≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è —Å–æ—Å—Ç–æ—è–Ω–∏—è

### 2. Structured Output —á–µ—Ä–µ–∑ Pydantic
‚úÖ **–ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞**:
- –ì–∞—Ä–∞–Ω—Ç–∏—Ä–æ–≤–∞–Ω–Ω–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ –æ—Ç–≤–µ—Ç–∞ LLM
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –≤–∞–ª–∏–¥–∞—Ü–∏—è
- –¢–∏–ø–æ–±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å
- –£–ø—Ä–æ—â–∞–µ—Ç –ø–∞—Ä—Å–∏–Ω–≥

### 3. –ì–∏–±—Ä–∏–¥–Ω–∞—è –æ—Ü–µ–Ω–∫–∞ (Rules + LLM)
‚úÖ **–ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞**:
- –ë—ã—Å—Ç—Ä—ã–µ —Ä–µ—à–µ–Ω–∏—è –¥–ª—è —è–≤–Ω—ã—Ö —Å–ª—É—á–∞–µ–≤
- –≠–∫–æ–Ω–æ–º–∏—è API-—Ç–æ–∫–µ–Ω–æ–≤
- LLM —Ç–æ–ª—å–∫–æ —Ç–∞–º, –≥–¥–µ –Ω—É–∂–Ω–∞ —Å–ª–æ–∂–Ω–∞—è –ª–æ–≥–∏–∫–∞
- –õ—É—á—à–∞—è –∏–Ω—Ç–µ—Ä–ø—Ä–µ—Ç–∏—Ä—É–µ–º–æ—Å—Ç—å

### 4. Phoenix –¥–ª—è observability
‚úÖ **–ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞**:
- –ü–æ–ª–Ω–∞—è –≤–∏–¥–∏–º–æ—Å—Ç—å LLM –≤—ã–∑–æ–≤–æ–≤
- –û—Ç–ª–∞–¥–∫–∞ –ø—Ä–æ–º–ø—Ç–æ–≤
- –ê–Ω–∞–ª–∏–∑ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏
- –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å LangChain

### 5. –ú–æ–¥–∏—Ñ–∏–∫–∞—Ü–∏—è config.py —á–µ—Ä–µ–∑ regex
‚ö†Ô∏è **–ö–æ–º–ø—Ä–æ–º–∏—Å—Å**:
- –ù–µ —Ç—Ä–µ–±—É–µ—Ç AST –ø–∞—Ä—Å–∏–Ω–≥–∞
- –ü—Ä–æ—Å—Ç–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è
- –•—Ä—É–ø–∫–∞—è –∫ —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏—é
- –û–≥—Ä–∞–Ω–∏—á–µ–Ω–Ω–∞—è –ø–æ–¥–¥–µ—Ä–∂–∫–∞ —Å–ª–æ–∂–Ω—ã—Ö –∏–∑–º–µ–Ω–µ–Ω–∏–π

---

## –†–∞—Å—à–∏—Ä—è–µ–º–æ—Å—Ç—å

### –ö–∞–∫ –¥–æ–±–∞–≤–∏—Ç—å –Ω–æ–≤—ã–π —Ç–∏–ø –∏–∑–º–µ–Ω–µ–Ω–∏–π:

1. –û–±–Ω–æ–≤–∏—Ç—å `_replace_class_assignment()` –¥–ª—è –Ω–æ–≤—ã—Ö –∫–ª–∞—Å—Å–æ–≤
2. –î–æ–±–∞–≤–∏—Ç—å mapping –≤ `class_mappings`
3. –û–±–Ω–æ–≤–∏—Ç—å `PLANNER_PROMPT` —Å –ø—Ä–∏–º–µ—Ä–∞–º–∏

### –ö–∞–∫ –¥–æ–±–∞–≤–∏—Ç—å –Ω–æ–≤—ã–π —É–∑–µ–ª –≤ –≥—Ä–∞—Ñ:

1. –°–æ–∑–¥–∞—Ç—å —Ñ—É–Ω–∫—Ü–∏—é —É–∑–ª–∞: `def new_node(state: NASGraphState)`
2. –î–æ–±–∞–≤–∏—Ç—å –≤ `build_nas_graph()`:
   ```python
   workflow.add_node("new_node", new_node)
   workflow.add_edge("previous_node", "new_node")
   ```

### –ö–∞–∫ –∏–∑–º–µ–Ω–∏—Ç—å —Å—Ç—Ä–∞—Ç–µ–≥–∏—é –æ—Ü–µ–Ω–∫–∏:

1. –ú–æ–¥–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞—Ç—å `evaluate_run_deterministic()` –¥–ª—è –Ω–æ–≤—ã—Ö –ø—Ä–∞–≤–∏–ª
2. –û–±–Ω–æ–≤–∏—Ç—å `EVALUATOR_PROMPT` –¥–ª—è LLM
3. –î–æ–±–∞–≤–∏—Ç—å –Ω–æ–≤—ã–µ –ø–æ–ª—è –≤ `EvaluatorDecision`

---

## –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏

**–û—Å–Ω–æ–≤–Ω—ã–µ**:
- `langgraph` - State machine orchestration
- `langchain-openai` - LLM –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è
- `pydantic` - Structured outputs

**Observability**:
- `arize-phoenix` - UI –¥–ª—è —Ç—Ä–µ–π—Å–æ–≤
- `openinference-instrumentation-langchain`
- `openinference-instrumentation-openai`

**–û—Å—Ç–∞–ª—å–Ω–æ–µ**:
- `python-dotenv` - Environment variables
- `pathlib`, `subprocess`, `json`, `re` - –°—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–∞—è –±–∏–±–ª–∏–æ—Ç–µ–∫–∞

---

## –ú–µ—Ç—Ä–∏–∫–∏ –∏ –æ—Ç–ª–∞–¥–∫–∞

### –õ–æ–≥–∏ –≤—ã–≤–æ–¥—è—Ç:
- –¢–µ–∫—É—â—É—é –∏—Ç–µ—Ä–∞—Ü–∏—é –∏ best_mse
- –†–µ—à–µ–Ω–∏—è Planner (step_type, plan, changes)
- –°—Ç–∞—Ç—É—Å –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –æ–±—É—á–µ–Ω–∏—è
- –†–µ—à–µ–Ω–∏—è Evaluator (accept/reject, reason)
- –§–∏–Ω–∞–ª—å–Ω—É—é —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É (total runs, accepted/rejected)

### Phoenix —Ç—Ä–µ–π—Å–∏–Ω–≥ –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç:
- –ü–æ–ª–Ω—ã–µ –ø—Ä–æ–º–ø—Ç—ã –∏ –æ—Ç–≤–µ—Ç—ã LLM
- Timing –∫–∞–∂–¥–æ–π –æ–ø–µ—Ä–∞—Ü–∏–∏
- –ê—Ç—Ä–∏–±—É—Ç—ã –∏ —Å–æ–±—ã—Ç–∏—è —É–∑–ª–æ–≤
- –û—à–∏–±–∫–∏ –∏ –∏—Å–∫–ª—é—á–µ–Ω–∏—è
- –ì—Ä–∞—Ñ –≤—ã–∑–æ–≤–æ–≤

### –§–∞–π–ª—ã —Å–æ—Å—Ç–æ—è–Ω–∏—è:
- `agent_state.json` - –∏—Å—Ç–æ—Ä–∏—è –≤—Å–µ—Ö –∑–∞–ø—É—Å–∫–æ–≤
- `runs/run_XXXX/metrics.json` - –º–µ—Ç—Ä–∏–∫–∏ –∫–∞–∂–¥–æ–≥–æ –∑–∞–ø—É—Å–∫–∞
- `runs/run_XXXX/history.json` - –ø–æ–ª–Ω–∞—è –∏—Å—Ç–æ—Ä–∏—è –æ–±—É—á–µ–Ω–∏—è
- `runs/run_XXXX/config_used.yaml` - –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–Ω–∞—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è

---

## –ó–∞–∫–ª—é—á–µ–Ω–∏–µ

–°–∏—Å—Ç–µ–º–∞ –ø—Ä–µ–¥—Å—Ç–∞–≤–ª—è–µ—Ç —Å–æ–±–æ–π **—Ö–æ—Ä–æ—à–æ —Å—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–π LLM-–æ—Ä–∫–µ—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–π NAS**, –≥–¥–µ:

- **Planner** (LLM) - –º–æ–∑–≥ —Å–∏—Å—Ç–µ–º—ã, –ø—Ä–∏–Ω–∏–º–∞–µ—Ç —Å—Ç—Ä–∞—Ç–µ–≥–∏—á–µ—Å–∫–∏–µ —Ä–µ—à–µ–Ω–∏—è
- **Executor** (No LLM) - –∏—Å–ø–æ–ª–Ω–∏—Ç–µ–ª—å, –ø—Ä–∏–º–µ–Ω—è–µ—Ç –∏–∑–º–µ–Ω–µ–Ω–∏—è –∏ –∑–∞–ø—É—Å–∫–∞–µ—Ç –æ–±—É—á–µ–Ω–∏–µ
- **Evaluator** (Hybrid) - –∞–Ω–∞–ª–∏—Ç–∏–∫, –æ—Ü–µ–Ω–∏–≤–∞–µ—Ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã —Å –ø–æ–º–æ—â—å—é –ø—Ä–∞–≤–∏–ª –∏ LLM
- **Update State** (No LLM) - —Ö—Ä–∞–Ω–∏—Ç–µ–ª—å, —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç –∏—Å—Ç–æ—Ä–∏—é
- **LangGraph** - –¥–∏—Ä–∏–∂–µ—Ä, –∫–æ–æ—Ä–¥–∏–Ω–∏—Ä—É–µ—Ç –≤–µ—Å—å –ø—Ä–æ—Ü–µ—Å—Å

–ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –ø–æ–∑–≤–æ–ª—è–µ—Ç —Å–∏—Å—Ç–µ–º–µ **–∞–≤—Ç–æ–Ω–æ–º–Ω–æ –∏—Å—Å–ª–µ–¥–æ–≤–∞—Ç—å –ø—Ä–æ—Å—Ç—Ä–∞–Ω—Å—Ç–≤–æ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–π**, —É—á–∏—Ç—å—Å—è –Ω–∞ –ø—Ä–µ–¥—ã–¥—É—â–∏—Ö –ø–æ–ø—ã—Ç–∫–∞—Ö –∏ –ø–æ—Å—Ç–µ–ø–µ–Ω–Ω–æ —É–ª—É—á—à–∞—Ç—å –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å –º–æ–¥–µ–ª–∏ –±–µ–∑ —Ä—É—á–Ω–æ–≥–æ –≤–º–µ—à–∞—Ç–µ–ª—å—Å—Ç–≤–∞.
